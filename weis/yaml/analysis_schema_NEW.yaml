$schema: "http://json-schema.org/draft-07/schema#"
$id: WISDEM_optimization_options_schema_v00
title: WISDEM wind turbine optimization options schema
description: Scehma that describes the analysis and optimization options for WISDEM
type: object
properties:
    general:
        type: object
        default: {}
        properties:
            folder_output:
                type: string
                default: output
                description: Name of folder to dump output files
            fname_output:
                type: string
                default: output
                description: File prefix for output files
    design_variables:
        type: object
        default: {}
        properties:
            blade:
                type: object
                default: {}
                properties:
                    aero_shape:
                        type: object
                        default: {}
                        properties:
                            twist:
                                type: object
                                default: {}
                                properties:
                                    flag: &flag
                                        type: boolean
                                        default: False
                                        description: Activates as a design variable or constraint
                                    inverse:
                                        type: boolean
                                        default: False
                                        description: Words TODO?
                                    n_opt: &nopt
                                        type: integer
                                        default: 8
                                        description: Number of control points to use
                                    lower_bound:
                                        type: array
                                        default: [-0.1, -0.1, -0.1, -0.1, -0.1, -0.1, -0.1, -0.1]
                                        items:
                                            type: number
                                            unit: rad
                                    upper_bound:
                                        type: array
                                        default: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
                                        items:
                                            type: number
                                            unit: rad
                            chord:
                                type: object
                                default: {}
                                properties:
                                    flag: *flag
                                    n_opt: *nopt
                                    min_gain:  &mingain
                                        type: number
                                        default: 0.5
                                        unit: none
                                        description: Lower bound on scalar multiplier that will be applied to value at control points
                                    max_gain: &maxgain
                                        type: number
                                        default: 1.5
                                        unit: none
                                        description: Upper bound on scalar multiplier that will be applied to value at control points
                            af_positions:
                                type: object
                                default: {}
                                properties:
                                    flag: *flag
                                    af_start:
                                        type: integer
                                        default: 4
                                        description: Index of airfoil where the optimization can start shifting airfoil position
                            length:
                                type: object
                                default: {}
                                properties:
                                    flag: *flag
                                    lower_bound:
                                        type: number
                                        default: 50.0
                                        unit: m
                                        description: Lower bound for design variable during optimization
                                    upper_bound:
                                        type: number
                                        default: 200.0
                                        unit: m
                                        description: Upper bound for design variable during optimization
                            prebend:
                                type: object
                                default: {}
                                properties:
                                    flag: *flag
                                    n_opt: *nopt
                                    lower_bound:
                                        type: array
                                        default: [-10.0, -10.0, -10.0, -10.0, -10.0, -10.0, -10.0, -10.0]
                                        items:
                                            type: number
                                            unit: m
                                    upper_bound:
                                        type: array
                                        default: [10.0, 10.0, 10.0, 10.0, 10.0, 10.0, 10.0, 10.0]
                                        items:
                                            type: number
                                            unit: m
                            sweep:
                                type: object
                                default: {}
                                properties:
                                    flag: *flag
                                    n_opt: *nopt
                                    lower_bound:
                                        type: array
                                        default: [-10.0, -10.0, -10.0, -10.0, -10.0, -10.0, -10.0, -10.0]
                                        items:
                                            type: number
                                            unit: m
                                    upper_bound:
                                        type: array
                                        default: [10.0, 10.0, 10.0, 10.0, 10.0, 10.0, 10.0, 10.0]
                                        items:
                                            type: number
                                            unit: m

                    structure:
                        type: object
                        default: {}
                        properties:
                            spar_cap_ss:
                                type: object
                                default: {}
                                properties:
                                    name: &name
                                        type: string
                                        default: 'none'
                                        description: Layer name of this design variable in the geometry yaml
                                    flag: *flag
                                    n_opt: *nopt
                                    min_gain: *mingain
                                    max_gain: *maxgain
                            spar_cap_ps:
                                type: object
                                default: {}
                                properties:
                                    name: *name
                                    flag: *flag
                                    n_opt: *nopt
                                    min_gain: *mingain
                                    max_gain: *maxgain
                            te_ss:
                                type: object
                                default: {}
                                properties:
                                    name: *name
                                    flag: *flag
                                    n_opt: *nopt
                                    min_gain: *mingain
                                    max_gain: *maxgain
                            te_ps:
                                type: object
                                default: {}
                                properties:
                                    name: *name
                                    flag: *flag
                                    n_opt: *nopt
                                    min_gain: *mingain
                                    max_gain: *maxgain
            tower:
                type: object
                default: {}
                properties:
                    outer_diameter:
                        type: object
                        default: {}
                        properties:
                            flag: *flag
                            lower_bound: &dbound
                                type: number
                                minimum: 0.1
                                maximum: 100.0
                                default: 5.0
                                unit: m
                            upper_bound: *dbound
                    layer_thickness:
                        type: object
                        default: {}
                        properties:
                            flag: *flag
                            lower_bound: &tbound
                                type: number
                                minimum: 1e-5
                                maximum: 1.0
                                default: 1e-2
                                unit: m
                            upper_bound: *tbound
                    section_height:
                        type: object
                        default: {}
                        properties:
                            flag: *flag
                            lower_bound: &sbound
                                type: number
                                minimum: 1e-1
                                maximum: 100.0
                                default: 5.0
                                unit: m
                            upper_bound: *sbound
            floating:
                type: object
                default: {}
                properties:
                    joints:
                        type: object
                        default: {}
                        properties:
                            z_coordinate:
                                description: This opens up the z-coordinate of the joints as a DV to change the draft or freeboard of a member
                                type: object
                                default: {}
                                properties:
                                    linked: &joint_link
                                        description: Joints that are listed together in a single entry will share the same coordinate. Can have multiple groups, each with their own shared value &
                                        type: array
                                        default: []
                                        items:
                                            type: object
                                            properties:
                                                names:
                                                    type: array
                                                    default: []
                                                    description: Names of the joints that are linked
                                                    items:
                                                        type: string
                                                flag: *flag
                                                lower_bound: &lb_m
                                                    type: number
                                                    unit: meter
                                                    description: Lower bound on design variable
                                                upper_bound: &ub_m
                                                    type: number
                                                    unit: meter
                                                    description: Upper bound on design variable
                                    independent: &joint_indep
                                        description: Joints that are listed here will have independent and separate z-coordinate.
                                        type: object
                                        default: {}
                                        properties:
                                            names:
                                                type: array
                                                default: []
                                                description: Names of the joints that are linked
                                                items:
                                                    type: string
                                            flag: *flag
                                            lower_bound: *lb_m
                                            upper_bound: *ub_m
                            x_coordinate:
                                description: This opens up the x-coordinate of the joints as a DV to change the x-value of the columns if using a polyonal column layout
                                type: object
                                default: {}
                                properties:
                                    linked: *joint_link
                                    independent: *joint_indep
                            y_coordinate:
                                description: This opens up the y-coordinate of the joints as a DV to change the y-value of the columns if using a polyonal column layout
                                type: object
                                default: {}
                                properties:
                                    linked: *joint_link
                                    independent: *joint_indep
                            r_coordinate:
                                description: This opens up the r-coordinate of the joints as a DV to change the radial spacing of the columns or fairlead attachments. Joints will be placed in cylindrical coordinates
                                type: object
                                default: {}
                                properties:
                                    linked: *joint_link
                                    independent: *joint_indep
                    members:
                        type: object
                        default: {}
                        properties:
                            diameter:
                                description: Adjustment of the diameter or side lengths schedule along the member(s). Similar to the joints, can link member geometry together for symmetry
                                type: object
                                default: {}
                                properties:
                                    linked: *joint_link
                                    independent: *joint_indep
                            layer_thickness:
                                description: Adjustment of the thickness schedule along the member(s). Similar to the joints, can link member geometry together for symmetry
                                type: object
                                default: {}
                                properties:
                                    linked: *joint_link
                                    independent: *joint_indep
                            ballast:
                                description: Adjustment of the permanent and variable ballast volume the member(s). Similar to the joints, can link members together for symmetry
                                type: object
                                default: {}
                                properties:
                                    linked: *joint_link
                                    independent: *joint_indep
                            axial_joints:
                                description: Adjust the non-dimensional axis coordinate of the joint location(s).  Similar to the joints, can link members together for symmetry
                                type: object
                                default: {}
                                properties:
                                    linked:
                                        description: Joints that are listed together in a single entry will share the same coordinate. Can have multiple groups, each with their own shared value &
                                        type: array
                                        default: []
                                        items:
                                            type: object
                                            properties:
                                                names:
                                                    type: array
                                                    default: []
                                                    description: Names of the joints that are linked
                                                    items:
                                                        type: string
                                                flag: *flag
                                                lower_bound: &lb_s
                                                    type: number
                                                    unit: none
                                                    description: Lower bound on design variable
                                                    default: 0.0
                                                    minimum: 0.0
                                                    maximum: 1.0
                                                upper_bound: &ub_s
                                                    type: number
                                                    unit: none
                                                    description: Upper bound on design variable
                                                    default: 1.0
                                                    minimum: 0.0
                                                    maximum: 1.0
                                    independent:
                                        description: Joints that are listed here will have independent and separate coordinates.
                                        type: object
                                        default: {}
                                        properties:
                                            names:
                                                type: array
                                                default: []
                                                description: Names of the joints that are linked
                                                items:
                                                    type: string
                                            flag: *flag
                                            lower_bound: *lb_s
                                            upper_bound: *ub_s
                            stiffeners:
                                type: object
                                default: {}
                                properties:
                                    ring:
                                        type: object
                                        default: {}
                                        properties:
                                            size: &stiff_size
                                                description: Applies a scalar multiplier to stiffener dimensions (web height, web thickness, flange height, flange thickness)
                                                flag: *flag
                                                min_gain: *mingain
                                                max_gain: *maxgain
                                            spacing:
                                                description: Adjust the spacing of the ring stiffeners in non-dimensional coordinates along the member axis
                                                flag: *flag
                                                lower_bound:
                                                    type: number
                                                    unit: none
                                                    description: Lower bound on design variable
                                                    default: 0.1
                                                    minimum: 0.01
                                                    maximum: 1.0
                                                upper_bound:
                                                    type: number
                                                    unit: none
                                                    description: Upper bound on design variable
                                                    default: 1.0
                                                    minimum: 0.01
                                                    maximum: 1.0
                                    longitudal:
                                        type: object
                                        default: {}
                                        properties:
                                            size: *stiff_size
                                            spacing:
                                                description: Adjust the spacing of the longitudal stiffeners in angle
                                                flag: *flag
                                                lower_bound:
                                                    type: number
                                                    unit: radians
                                                    description: Lower bound on design variable
                                                    default: 0.7853981633974483 # 45 deg
                                                    minimum: 0.08726646259971647 # 5 deg
                                                    maximum: 6.283185307179586 # 360 deg
                                                upper_bound:
                                                    type: number
                                                    unit: radians
                                                    description: Upper bound on design variable
                                                    default: 1.5707963267948966 # 90 deg
                                                    minimum: 0.08726646259971647 # 5 deg
                                                    maximum: 6.283185307179586 # 360 deg

                    mooring:
                        type: object
                        default: {}
                        properties:
                            anchor_radius:
                                flag: *flag
                                description: Adjust the radial distance of the anchors relative to the platform centerline
                                lower_bound: *lb_m
                                upper_bound: *ub_m
                            line_length:
                                description: Adjust the unstretched length of the mooring lines.  Can link lines together.
                                type: object
                                default: {}
                                properties:
                                    linked: *joint_link
                                    independent: *joint_indep
                            line_diameter:
                                description: Adjust the unstretched length of the mooring lines.  Can link lines together.
                                type: object
                                default: {}
                                properties:
                                    linked: *joint_link
                                    independent: *joint_indep
            actuators:
                type: object
                default: {}
                properties:
                    generator:
                        type: object
                        default: {}
                        properties:
                            rated_power:
                                type: object
                                description: Generator rated power
                                default: {}
                                properties:
                                    flag: *flag
                                    lower_bound:
                                        type: number
                                        default: 0.0
                                        unit: MW
                                    upper_bound:
                                        type: number
                                        default: 100.0
                                        unit: MW
                            rated_gen_speed:
                                type: object
                                description: Rated generator speed
                                default: {}
                                properties:
                                    flag: *flag
                                    lower_bound: 
                                        type: number
                                        default: 0.0
                                        unit: rad/s
                                    upper_bound:
                                        type: number
                                        default: 100000000.0
                                        unit: rad/s
                            rated_gen_torque:
                                type: object
                                description: Rated generator torque
                                default: {}
                                properties:
                                    flag: *flag
                                    lower_bound: 
                                        type: number
                                        default: 0.0
                                        unit: kNm
                                    upper_bound:
                                        type: number
                                        default: 1000000000000.0
                                        unit: kNm
            control:
                type: object
                default: {}
                properties:
                    pitch:
                        type: object
                        default: {}
                        properties:
                            PC_omega: 
                                type: object
                                description: Pitch controller desired natural frequency. It is used by the ROSCO controller (https://github.com/NREL/ROSCO)
                                default: {}
                                properties:
                                    flag: *flag
                                    lower_bound: &omega_min
                                        type: number
                                        default: 0.0
                                        unit: rad/s
                                    upper_bound: &omega_max
                                        type: number
                                        default: 100.0
                                        unit: rad/s
                            PC_zeta:
                                type: object
                                description: Pitch controller desired damping ratio. It is used by the ROSCO controller (https://github.com/NREL/ROSCO)
                                default: {}
                                properties:
                                    flag: *flag
                                    lower_bound: &zeta_min
                                        type: number
                                        default: 0.0
                                        unit: none
                                    upper_bound: &zeta_max
                                        type: number
                                        default: 100.0
                                        unit: none
                            ps_percent:
                                type: object
                                default: {}
                                description: Percent peak shaving as a design variable
                                properties:
                                    flag: *flag
                                    lower_bound:
                                        type: number
                                        default: 0.0
                                        unit: none
                                    upper_bound:
                                        type: number
                                        default: 1.0
                                        unit: none
                            fl_feedback:
                                type: object
                                description: Platform velocity feedback using nacelle IMU
                                default: {}
                                properties:
                                    gain:
                                        type: object
                                        default: {}
                                        description: Gain of floating feedback using nacelle IMU
                                        properties:
                                            flag: *flag
                                            lower_bound:
                                                type: number
                                                default: 0.0
                                                unit: seconds
                                            upper_bound:
                                                type: number
                                                default: 10000
                                                unit: seconds
                                    filter:
                                        type: object
                                        default: {}
                                        description: Filter from in platform pitch feedback
                                        properties:
                                            flag: *flag
                            IPC:
                                type: object
                                description: Individual pitch control (IPC) using the mulitblade coordinate (MBC) transform
                                default: {}
                                properties:
                                    IPC_gain_1P:
                                        type: object
                                        default: {}
                                        description: Integral gain of 1P feedback
                                        properties:
                                            flag: *flag
                                            lower_bound:
                                                type: number
                                                default: 0.0
                                                unit: rad/Nm
                                            upper_bound:
                                                type: number
                                                default: 10000
                                                unit: rad/Nm
                                    IPC_phase_1P:
                                        type: object
                                        default: {}
                                        description: Phase lag of 1P IPC feedback
                                        properties:
                                            flag: *flag
                                            lower_bound:
                                                type: number
                                                default: -3.14
                                                unit: rad
                                            upper_bound:
                                                type: number
                                                default: 3.14
                                                unit: rad
                    torque:
                        type: object
                        default: {}
                        properties:
                            VS_zeta:
                                type: object
                                default: {}
                                description: Damping ratio of torque control regulator mode
                                properties:
                                    flag: *flag
                                    lower_bound: *zeta_min
                                    upper_bound: *zeta_max
                            VS_omega:
                                type: object
                                default: {}
                                description: Natural frequency of torque control regulator mode
                                properties:
                                    flag: *flag
                                    lower_bound: *omega_min
                                    upper_bound: *omega_max
                    flap_control:
                        type: object
                        default: {}
                        properties:
                            flag: *flag
                            omega_min: *omega_min
                            omega_max: *omega_max
                            zeta_min: *zeta_min
                            zeta_max: *zeta_max

    constraints:
        # GB: These all need gammas or safety factors
        type: object
        default: {}
        properties:
            blade:
                type: object
                default: {}
                properties:
                    strains_spar_cap_ss:
                        type: object
                        default: {}
                        properties:
                            flag: *flag
                            max: &maxstrain
                                type: number
                                default: 4000e-6
                                minimum: 1e-8
                                maximum: 1e-1
                    strains_spar_cap_ps:
                        type: object
                        default: {}
                        properties:
                            flag: *flag
                            max: *maxstrain
                    tip_deflection: &flagonly
                        type: object
                        default: {}
                        properties:
                            flag: *flag
                    rail_transport:
                        type: object
                        default: {}
                        properties:
                            # Flag redundant?
                            flag: *flag
                            8_axle: *flag
                            4_axle: *flag
                    stall:
                        type: object
                        description: Ensuring blade angles of attacks do not approach the stall point
                        default: {}
                        properties:
                            flag: *flag
                            margin:
                                type: number
                                default: 0.05233 # 3 deg
                                minimum: 0.0
                                maximum: 0.5
                    chord:
                        type: object
                        description: Enforcing max chord length limit
                        default: {}
                        properties:
                            flag: *flag
                            max:
                                type: number
                                default: 4.3
                                minimum: 0.1
                                maximum: 20.0
                    frequency:
                        type: object
                        description: Frequency separation constraint
                        default: {}
                        properties:
                            flap_above_3P: *flag
                            edge_above_3P: *flag
                            flap_below_3P: *flag
                            edge_below_3P: *flag
                    moment_coefficient:
                        type: object
                        description: Targeted blade moment coefficient
                        default: {}
                        properties:
                            flag: *flag
                            min: &cmminmax
                                type: number
                                default: 0.15
                                minimum: 0.01
                                maximum: 5.0
                            max: *cmminmax
                    match_cl_cd:
                        type: object
                        description: Targeted blade moment coefficient
                        default: {}
                        properties:
                            flag_cl: *flag
                            flag_cd: *flag
                            filename: &filepath
                                type: string
                                description: file path to constraint data
                                default: ''
                    match_L_D:
                        type: object
                        description: Targeted blade moment coefficient
                        default: {}
                        properties:
                            flag_L: *flag
                            flag_D: *flag
                            filename: *filepath
            tower:
                type: object
                default: {}
                properties:
                    height_constraint:
                        type: object
                        description: Double-sided constraint to ensure total tower height meets target hub height
                        default: {}
                        properties:
                            flag: *flag
                            lower_bound: &hbound
                                type: number
                                minimum: 1e-6
                                maximum: 10.0
                                default: 1e-2
                                unit: m
                            upper_bound: *hbound
                    stress: *flagonly
                    global_buckling: *flagonly
                    shell_buckling: *flagonly
                    weldability: *flagonly
                    manufacturability: *flagonly
                    slope: *flagonly
                    frequency_1:
                        type: object
                        description: Targeted range for tower first frequency constraint
                        default: {}
                        properties:
                            flag: *flag
                            lower_bound: &fminmax
                                type: number
                                default: 0.1
                                minimum: 0.01
                                maximum: 1.0
                            upper_bound: *fminmax
            control:
                type: object
                default: {}
                properties:
                    flap_control:
                        type: object
                        description: Words TODO  # DZ: I'm not sure what this represents
                        default: {}
                        properties:
                            flag: *flag
                            min: &flapminmax
                                type: number
                                default: 0.05
                                minimum: 0.0
                                maximum: 1.0
                            max: *flapminmax
                    max_tip_speed:
                        type: object
                        description: Maximum allowable tip speed
                        default: {}
                        properties:
                            flag: *flag
                            min: &tip_minmax
                                type: number
                                untis: m/s
                                default: 100
                                minimum: 0.0
                                maximum: 200
                            max: *tip_minmax
                    max_gen_speed:
                        type: object
                        description: Maximum allowable generator speed
                        default: {}
                        properties:
                            flag: *flag
                            min: &gen_minmax
                                type: number
                                units: rad/s
                                default: 1.0
                                minimum: 0.0
                                maximum: 100000.0
                            max: *gen_minmax

    merit_figure:
        type: string
        description: Objective function / merit figure for optimization
        default: LCOE
        enum: [LCOE, AEP, Cp, blade_mass, tower_mass, tower_cost, blade_tip_deflection, My_std, flp1_std]

    driver:
        type: object
        description: Specification of the optimization driver (optimization algorithm) parameters
        default: {}
        properties:
            tol:
                type: number
                description: Convergence tolerance (relative)
                default: 1e-6
                minimum: 1e-12
                maximum: 1.0
                unit: none
            max_iter:
                type: integer
                description: Max number of optimization iterations
                default: 100
                minimum: 0
                maximum: 100000
            max_function_calls:
                type: integer
                description: Max number of calls to objective function evaluation
                default: 100000
                minimum: 0
                maximum: 100000000
            solver:
                type: string
                description: Optimization driver
                default: SLSQP
                enum: [SLSQP, CONMIN, COBYLA, SNOPT]
            step_size:
                type: number
                description: Maximum step size
                default: 1e-3
                minimum: 1e-10
                maximum: 100.0
            form:
                type: string
                description: Finite difference calculation mode
                default: central
                enum: [central, forward, complex]

    recorder:
        type: object
        default: {}
        description: Optimization iteration recording
        properties:
            flag: *flag
            file_name:
                type: string
                description: OpenMDAO recorder output SQL database file
                default: log_opt.sql
